---
title: "cm009 Notes and Exercises: Table Joins"
date: '2017-10-03'
output: github_document
---



<pre class="r"><code>suppressPackageStartupMessages(library(dplyr))</code></pre>
<pre><code>## Warning: package &#39;dplyr&#39; was built under R version 3.5.2</code></pre>
<pre class="r"><code>suppressPackageStartupMessages(library(gapminder))</code></pre>
<p>After going through the <code>dplyr</code> <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/two-table.html">vignette</a> on “two-table verbs”, we’ll work on the following exercises.</p>
<p>Consider the following areas of countries, in hectares:</p>
<pre class="r"><code>(areas &lt;- data.frame(country=c(&quot;Canada&quot;, &quot;United States&quot;, &quot;India&quot;, &quot;Vatican City&quot;),
                     area=c(998.5*10^6, 983.4*10^6, 328.7*10^6, 44)) %&gt;% 
     as.tbl)</code></pre>
<pre><code>## # A tibble: 4 x 2
##   country            area
##   &lt;fct&gt;             &lt;dbl&gt;
## 1 Canada        998500000
## 2 United States 983400000
## 3 India         328700000
## 4 Vatican City         44</code></pre>
<ol style="list-style-type: decimal">
<li>To the <code>gapminder</code> dataset, add an <code>area</code> variable using the <code>areas</code> tibble. Be sure to preserve all the rows of the original <code>gapminder</code> dataset.</li>
</ol>
<pre class="r"><code>left_join(gapminder, areas)</code></pre>
<pre><code>## Joining, by = &quot;country&quot;</code></pre>
<pre><code>## Warning: Column `country` joining factors with different levels, coercing
## to character vector</code></pre>
<pre><code>## # A tibble: 1,704 x 7
##    country     continent  year lifeExp      pop gdpPercap  area
##    &lt;chr&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.    NA
##  2 Afghanistan Asia       1957    30.3  9240934      821.    NA
##  3 Afghanistan Asia       1962    32.0 10267083      853.    NA
##  4 Afghanistan Asia       1967    34.0 11537966      836.    NA
##  5 Afghanistan Asia       1972    36.1 13079460      740.    NA
##  6 Afghanistan Asia       1977    38.4 14880372      786.    NA
##  7 Afghanistan Asia       1982    39.9 12881816      978.    NA
##  8 Afghanistan Asia       1987    40.8 13867957      852.    NA
##  9 Afghanistan Asia       1992    41.7 16317921      649.    NA
## 10 Afghanistan Asia       1997    41.8 22227415      635.    NA
## # … with 1,694 more rows</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>To the <code>gapminder</code> dataset, add an <code>area</code> variable using the <code>areas</code> tibble, but only keeping obervations for which areas are available.</li>
</ol>
<pre class="r"><code>inner_join(gapminder, areas)</code></pre>
<pre><code>## Joining, by = &quot;country&quot;</code></pre>
<pre><code>## Warning: Column `country` joining factors with different levels, coercing
## to character vector</code></pre>
<pre><code>## # A tibble: 36 x 7
##    country continent  year lifeExp      pop gdpPercap      area
##    &lt;chr&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 Canada  Americas   1952    68.8 14785584    11367. 998500000
##  2 Canada  Americas   1957    70.0 17010154    12490. 998500000
##  3 Canada  Americas   1962    71.3 18985849    13462. 998500000
##  4 Canada  Americas   1967    72.1 20819767    16077. 998500000
##  5 Canada  Americas   1972    72.9 22284500    18971. 998500000
##  6 Canada  Americas   1977    74.2 23796400    22091. 998500000
##  7 Canada  Americas   1982    75.8 25201900    22899. 998500000
##  8 Canada  Americas   1987    76.9 26549700    26627. 998500000
##  9 Canada  Americas   1992    78.0 28523502    26343. 998500000
## 10 Canada  Americas   1997    78.6 30305843    28955. 998500000
## # … with 26 more rows</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Use a <code>_join</code> function to output the rows in <code>areas</code> corresponding to countries that <em>are not</em> found in the <code>gapminder</code> dataset.</li>
</ol>
<pre class="r"><code>anti_join(areas, gapminder)</code></pre>
<pre><code>## Joining, by = &quot;country&quot;</code></pre>
<pre><code>## Warning: Column `country` joining factors with different levels, coercing
## to character vector</code></pre>
<pre><code>## # A tibble: 1 x 2
##   country       area
##   &lt;fct&gt;        &lt;dbl&gt;
## 1 Vatican City    44</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Use a <code>_join</code> function to output the rows in <code>areas</code> corresponding to countries that <em>are</em> found in the <code>gapminder</code> dataset.</li>
</ol>
<pre class="r"><code>semi_join(areas, gapminder, by=&quot;country&quot;)</code></pre>
<pre><code>## Warning: Column `country` joining factors with different levels, coercing
## to character vector</code></pre>
<pre><code>## # A tibble: 3 x 2
##   country            area
##   &lt;fct&gt;             &lt;dbl&gt;
## 1 Canada        998500000
## 2 United States 983400000
## 3 India         328700000</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Construct a tibble that joins <code>gapminder</code> and <code>areas</code>, so that all rows found in each original tibble are also found in the final tibble.</li>
</ol>
<pre class="r"><code>full_join(areas, gapminder)</code></pre>
<pre><code>## Joining, by = &quot;country&quot;</code></pre>
<pre><code>## Warning: Column `country` joining factors with different levels, coercing
## to character vector</code></pre>
<pre><code>## # A tibble: 1,705 x 7
##    country      area continent  year lifeExp      pop gdpPercap
##    &lt;chr&gt;       &lt;dbl&gt; &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Canada  998500000 Americas   1952    68.8 14785584    11367.
##  2 Canada  998500000 Americas   1957    70.0 17010154    12490.
##  3 Canada  998500000 Americas   1962    71.3 18985849    13462.
##  4 Canada  998500000 Americas   1967    72.1 20819767    16077.
##  5 Canada  998500000 Americas   1972    72.9 22284500    18971.
##  6 Canada  998500000 Americas   1977    74.2 23796400    22091.
##  7 Canada  998500000 Americas   1982    75.8 25201900    22899.
##  8 Canada  998500000 Americas   1987    76.9 26549700    26627.
##  9 Canada  998500000 Americas   1992    78.0 28523502    26343.
## 10 Canada  998500000 Americas   1997    78.6 30305843    28955.
## # … with 1,695 more rows</code></pre>
<pre class="r"><code>full_join(gapminder, areas)</code></pre>
<pre><code>## Joining, by = &quot;country&quot;</code></pre>
<pre><code>## Warning: Column `country` joining factors with different levels, coercing
## to character vector</code></pre>
<pre><code>## # A tibble: 1,705 x 7
##    country     continent  year lifeExp      pop gdpPercap  area
##    &lt;chr&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.    NA
##  2 Afghanistan Asia       1957    30.3  9240934      821.    NA
##  3 Afghanistan Asia       1962    32.0 10267083      853.    NA
##  4 Afghanistan Asia       1967    34.0 11537966      836.    NA
##  5 Afghanistan Asia       1972    36.1 13079460      740.    NA
##  6 Afghanistan Asia       1977    38.4 14880372      786.    NA
##  7 Afghanistan Asia       1982    39.9 12881816      978.    NA
##  8 Afghanistan Asia       1987    40.8 13867957      852.    NA
##  9 Afghanistan Asia       1992    41.7 16317921      649.    NA
## 10 Afghanistan Asia       1997    41.8 22227415      635.    NA
## # … with 1,695 more rows</code></pre>
<p>Here are the rows containing the Vatican City:</p>
<pre class="r"><code>full_join(areas, gapminder) %&gt;% 
    filter(country==&quot;Vatican City&quot;)</code></pre>
<pre><code>## Joining, by = &quot;country&quot;</code></pre>
<pre><code>## Warning: Column `country` joining factors with different levels, coercing
## to character vector</code></pre>
<pre><code>## # A tibble: 1 x 7
##   country       area continent  year lifeExp   pop gdpPercap
##   &lt;chr&gt;        &lt;dbl&gt; &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt; &lt;int&gt;     &lt;dbl&gt;
## 1 Vatican City    44 &lt;NA&gt;         NA      NA    NA        NA</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Subset the <code>gapminder</code> dataset to have countries that are only found in the <code>areas</code> data frame.</li>
</ol>
<pre class="r"><code>semi_join(gapminder, areas)</code></pre>
<pre><code>## Joining, by = &quot;country&quot;</code></pre>
<pre><code>## Warning: Column `country` joining factors with different levels, coercing
## to character vector</code></pre>
<pre><code>## # A tibble: 36 x 6
##    country continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Canada  Americas   1952    68.8 14785584    11367.
##  2 Canada  Americas   1957    70.0 17010154    12490.
##  3 Canada  Americas   1962    71.3 18985849    13462.
##  4 Canada  Americas   1967    72.1 20819767    16077.
##  5 Canada  Americas   1972    72.9 22284500    18971.
##  6 Canada  Americas   1977    74.2 23796400    22091.
##  7 Canada  Americas   1982    75.8 25201900    22899.
##  8 Canada  Americas   1987    76.9 26549700    26627.
##  9 Canada  Americas   1992    78.0 28523502    26343.
## 10 Canada  Americas   1997    78.6 30305843    28955.
## # … with 26 more rows</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Subset the <code>gapminder</code> dataset to have countries that are <em>not</em> found in the <code>areas</code> data frame.</li>
</ol>
<pre class="r"><code>anti_join(gapminder, areas)</code></pre>
<pre><code>## Joining, by = &quot;country&quot;</code></pre>
<pre><code>## Warning: Column `country` joining factors with different levels, coercing
## to character vector</code></pre>
<pre><code>## # A tibble: 1,668 x 6
##    country     continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.
##  2 Afghanistan Asia       1957    30.3  9240934      821.
##  3 Afghanistan Asia       1962    32.0 10267083      853.
##  4 Afghanistan Asia       1967    34.0 11537966      836.
##  5 Afghanistan Asia       1972    36.1 13079460      740.
##  6 Afghanistan Asia       1977    38.4 14880372      786.
##  7 Afghanistan Asia       1982    39.9 12881816      978.
##  8 Afghanistan Asia       1987    40.8 13867957      852.
##  9 Afghanistan Asia       1992    41.7 16317921      649.
## 10 Afghanistan Asia       1997    41.8 22227415      635.
## # … with 1,658 more rows</code></pre>
<p>Let’s check…. Canada should not be in there:</p>
<pre class="r"><code>anti_join(gapminder, areas) %&gt;% 
    filter(country==&quot;Canada&quot;)</code></pre>
<pre><code>## Joining, by = &quot;country&quot;</code></pre>
<pre><code>## Warning: Column `country` joining factors with different levels, coercing
## to character vector</code></pre>
<pre><code>## # A tibble: 0 x 6
## # … with 6 variables: country &lt;fct&gt;, continent &lt;fct&gt;, year &lt;int&gt;,
## #   lifeExp &lt;dbl&gt;, pop &lt;int&gt;, gdpPercap &lt;dbl&gt;</code></pre>
